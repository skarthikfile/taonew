define("taoDacSimple/controller/routes",[],function(){"user strict";return{AdminAccessController:{css:"admin",actions:{adminPermissions:"controller/admin/index"}}}}),define("tpl!taoDacSimple/controller/admin/line",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+="<tr>\n    <td>",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</td>\n    <td>\n        ",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\n        <input type="hidden" name="users[',(helper=helpers.user)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.user,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'][type]" value="',(helper=helpers.type)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    </td>\n    <td>\n        <label class="tooltip">\n            <input type="checkbox" class="privilege-GRANT" name="users[',(helper=helpers.user)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.user,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'][GRANT]" value="1">\n            <span class="icon-checkbox"></span>\n        </label>\n    </td>\n    <td>\n        <label class="tooltip">\n            <input type="checkbox" class="privilege-WRITE" name="users[',
(helper=helpers.user)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.user,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'][WRITE]" value="1" checked>\n            <span class="icon-checkbox"></span>\n        </label>\n    </td>\n    <td>\n        <label class="tooltip">\n            <input type="checkbox" class="privilege-READ" name="users[',(helper=helpers.user)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.user,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'][READ]" value="1" checked>\n            <span class="icon-checkbox"></span>\n        </label>\n    </td>\n    <td>\n        <button type="button" class="small delete_permission tooltip btn-warning" data-acl-user="',
(helper=helpers.user)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.user,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-acl-type="',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-acl-label="',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" >\n            <span class="icon-bin"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Remove",options):helperMissing.call(depth0,"__","Remove",options)))+"\n        </button>\n    </td>\n</tr>\n"})}),define("taoDacSimple/controller/admin/index",["jquery","lodash","i18n","tpl!taoDacSimple/controller/admin/line","helpers","ui/feedback","ui/autocomplete","tooltipster","jqueryui"],function($,_,__,lineTpl,helpers,feedback,autocomplete){"use strict";var linesThreshold=10,errorMsgManagePermission=__("You must have one role or user that have the manage permission on this element."),tooltipConfigManagePermission={content:__(errorMsgManagePermission),theme:"tao-warning-tooltip",trigger:"hover"},_checkManagers=function(container){
var $managers=$(container).find(".privilege-GRANT:checked"),checkOk=!0;return $managers.length||(checkOk=!1),checkOk},_preventManagerRemoval=function(container){var $form=$(container).closest("form"),$submitter=$(":submit",$form);$submitter.tooltipster(tooltipConfigManagePermission),_checkManagers($form)?$submitter.removeClass("disabled").tooltipster("disable"):($submitter.addClass("disabled").tooltipster("enable"),feedback().warning(errorMsgManagePermission))},_disableAccessOnGrant=function(container){var $container=$(container),$managersChecked=$container.find(".privilege-GRANT:checked").closest("tr"),$cantChangeWrite=$managersChecked.find(".privilege-WRITE"),$cantChangeRead=$managersChecked.find(".privilege-READ"),$managers=$container.find(".privilege-GRANT").not(":checked").closest("tr"),$canChangeWrite=$managers.find(".privilege-WRITE"),$canChangeRead=$managers.find(".privilege-READ");
$canChangeWrite.removeClass("disabled"),$canChangeRead.removeClass("disabled"),$cantChangeWrite.addClass("disabled").attr("checked",!0),$cantChangeRead.addClass("disabled").attr("checked",!0),_preventManagerRemoval($container),_disableAccessOnWrite($container)},_disableAccessOnWrite=function(container){var $container=$(container),$writersChecked=$container.find(".privilege-WRITE:checked").closest("tr"),$cantChangeRead=$writersChecked.find(".privilege-READ"),$writers=$container.find(".privilege-WRITE").not(":checked").closest("tr"),$canChangeRead=$writers.find(".privilege-READ");$canChangeRead.removeClass("disabled"),$cantChangeRead.addClass("disabled").attr("checked",!0);
},_deletePermission=function(element){var $this=$(element),$container=$this.closest("table"),type=$this.data("acl-type"),user=$this.data("acl-user"),label=$this.data("acl-label");_.isEmpty(type)||_.isEmpty(user)||_.isEmpty(label)||$this.closest("tr").remove(),_preventManagerRemoval($container),_manageTabsDisplay()},_checkPermission=function(container,type,id){var $btn=$(container).find('button[data-acl-user="'+id+'"]'),$line=$btn.closest("tr");return $line.length?($line.effect("highlight",{},1500),!0):!1},_addPermission=function(container,type,id,label){var $container=$(container),$body=$container.find("tbody").first();_checkPermission($container,type,id)||($body.append(lineTpl({
type:type,user:id,label:label})),_disableAccessOnGrant($container),_manageTabsDisplay())},_installListeners=function(container){var $container=$(container);$container.on("click",".privilege-GRANT:not(.disabled) ",function(){_disableAccessOnGrant($container)}).on("click",".privilege-WRITE:not(.disabled) ",function(){_disableAccessOnWrite($container)}).on("click",".delete_permission:not(.disabled)",function(event){event.preventDefault(),_deletePermission(this)})},_manageTabsDisplay=function(){var $focused,index,$tabs=$(".permission-tabs"),needsTabs=$tabs.find(".privilege-GRANT").length>linesThreshold;needsTabs?($tabs.find("ul").show(),$tabs.hasClass("ui-tabs")||($focused=$tabs.find(":focus").closest(".permission-tabs-panel"),
index=Math.max(0,$focused.index()-1),$tabs.tabs({selected:index,active:index})),$(".msg-edit-area label span").hide()):($tabs.hasClass("ui-tabs")&&($tabs.find(".ui-tabs-hide").removeClass("ui-tabs-hide"),$tabs.tabs("destroy")),$tabs.find("ul").hide(),$(".msg-edit-area label span").show())},_searchFactory=function(element,options){return _.isFunction(options)&&(options={onSelectItem:options}),options=_.assign({isProvider:!0,preventSubmit:!0},options||{}),autocomplete(element,options)},mainCtrl={start:function(){var $container=$(".permission-container"),$form=$("form",$container),$submitter=$(":submit",$form);_disableAccessOnGrant("#permissions-table-users"),_disableAccessOnGrant("#permissions-table-roles"),
_searchFactory("#add-user",function(event,value,label){$("#add-user").focus(),_addPermission("#permissions-table-users","user",value,label)}),_searchFactory("#add-role",function(event,value,label){$("#add-role").focus(),_addPermission("#permissions-table-roles","role",value,label)}),_installListeners("#permissions-table-users"),_installListeners("#permissions-table-roles"),_manageTabsDisplay(),$form.on("submit",function(e){e.preventDefault(),e.stopImmediatePropagation()}),$submitter.on("click",function(e){if(e.preventDefault(),!$submitter.hasClass("disabled")){if(!_checkManagers("form"))return void feedback().error(errorMsgManagePermission);$submitter.addClass("disabled"),
$.post($form.attr("action"),$form.serialize()).done(function(res){res&&res.success?feedback().success(__("Permissions saved")):feedback().error(__("Something went wrong..."))}).complete(function(){$submitter.removeClass("disabled")})}})}};return mainCtrl});
//# sourceMappingURL=controllers.min.js.map